<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="admin-style.css">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Mock Server Management</title>
    <style>
        * {
            box-sizing: border-box;
        }

        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
        }
        
        h1, h2 {
            color: #333;
            margin-bottom: 20px;
        }
        
        h1 {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 30px;
        }
        
        .nav-links {
            background: linear-gradient(45deg, #667eea, #764ba2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-links a:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .nav-links a.active {
            background: rgba(255,255,255,0.3);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
            font-size: 14px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            height: 120px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .delete-btn {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            box-shadow: 0 4px 12px rgba(255, 71, 87, 0.3);
        }
        
        .delete-btn:hover {
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
        }
        
        .refresh-btn {
            background: linear-gradient(45deg, #26c0d3, #20a8b8);
            box-shadow: 0 4px 12px rgba(38, 192, 211, 0.3);
        }
        
        .dropdown-btn {
            background: linear-gradient(45deg, #5f27cd, #341f97);
            box-shadow: 0 4px 12px rgba(95, 39, 205, 0.3);
        }
        
        .upload-btn {
            background: linear-gradient(45deg, #00d2d3, #54a0ff);
            box-shadow: 0 4px 12px rgba(0, 210, 211, 0.3);
        }
        
        .mock-item, .file-item {
            border: 2px solid #e1e5e9;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 12px;
            background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mock-item:hover, .file-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .mock-item.expanded, .file-item.expanded {
            background: #fff;
            border-color: #667eea;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.15);
        }
        
        .mock-header, .file-header {
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mock-summary, .file-summary {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .method-badge, .file-type-badge {
            padding: 6px 12px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
            text-transform: uppercase;
        }
        
        .method-GET { background: linear-gradient(45deg, #2ed573, #7bed9f); }
        .method-POST { background: linear-gradient(45deg, #3742fa, #5352ed); }
        .method-PUT { background: linear-gradient(45deg, #ffa502, #ff6348); }
        .method-DELETE { background: linear-gradient(45deg, #ff4757, #ff3742); }
        .method-PATCH { background: linear-gradient(45deg, #5f27cd, #341f97); }
        
        .current-scenario {
            background: linear-gradient(135deg, #2ed573, #7bed9f);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .scenario-flow {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            border-left: 4px solid #fdcb6e;
            color: #2d3436;
        }
        
        .json-preview {
            background: #2d3436;
            color: #00cec9;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            border: 1px solid #636e72;
            margin-top: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .mock-details, .file-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e1e5e9;
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #74b9ff;
            font-size: 1.1em;
        }
        
        .status-message {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .error {
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
            border: none;
        }
        
        .success {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border: none;
        }
        
        .warning {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            border: none;
        }
        
        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .scenario-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .scenario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .scenario-card:hover::before {
            left: 100%;
        }
        
        .scenario-card:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        .scenario-card.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-weight: 500;
        }
        
        .expand-icon {
            transition: transform 0.3s ease;
            font-size: 1.2em;
            color: #667eea;
        }
        
        .expand-icon.expanded {
            transform: rotate(90deg);
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .controls input, .controls select {
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            min-width: 150px;
        }
        
        .file-upload-area {
            border: 3px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            margin: 20px 0;
            transition: all 0.3s ease;
        }
        
        .file-upload-area:hover {
            border-color: #764ba2;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }
        
        .file-upload-area.dragover {
            border-color: #2ed573;
            background: linear-gradient(135deg, rgba(46, 213, 115, 0.1), rgba(123, 237, 159, 0.1));
        }
        
        .file-size {
            color: #666;
            font-size: 0.9em;
        }
        
        .database-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .database-indicator::before {
            content: '🗄️';
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .controls input, .controls select {
                min-width: auto;
            }
            
            .stats-grid, .scenarios-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e5e9;
        }
        
        .tab-button {
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* New styles for file-based mocks */
        .response-section {
            border: 1px solid #e1e5e9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
        }
        
        .response-section h4 {
            margin-top: 0;
            color: #495057;
        }
        
        input[type="radio"] {
            width: auto !important;
        }
        
        .file-badge {
            background: linear-gradient(45deg, #00d2d3, #54a0ff);
            padding: 6px 12px;
            border-radius: 20px;
            color: white;
            font-size: 0.85em;
        }
        
        /* Status code badge styles */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
        }
        
        .status-2xx { background: linear-gradient(45deg, #2ed573, #7bed9f); }
        .status-3xx { background: linear-gradient(45deg, #00d2d3, #54a0ff); }
        .status-4xx { background: linear-gradient(45deg, #ffa502, #ff6348); }
        .status-5xx { background: linear-gradient(45deg, #ff4757, #ff3742); }
        
        /* Status code input group */
        .status-code-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .status-code-group input {
            width: 120px;
            flex-shrink: 0;
        }
        
        .status-preset-btn {
            padding: 8px 16px;
            font-size: 0.9em;
            background: linear-gradient(45deg, #dfe6e9, #b2bec3);
            color: #2d3436;
        }
        
        .status-preset-btn:hover {
            background: linear-gradient(45deg, #b2bec3, #636e72);
            color: white;
        }
        
        .headers-input {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        /* Enhanced status code styles */
        #statusCodePresets {
            width: 250px;
        }
        
        #statusCodeDescription {
            margin-top: 10px;
            padding: 10px;
            background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            font-size: 0.9em;
            color: #495057;
        }
        
        .status-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-icon {
            font-size: 1.2em;
        }
        
        /* Delay configuration styles */
        .delay-section {
            border: 1px solid #e1e5e9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
        }
        
        .delay-type-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .delay-config {
            display: none;
            margin-top: 15px;
        }
        
        .delay-config.active {
            display: block;
        }
        
        .delay-badge {
            background: linear-gradient(45deg, #ff9ff3, #f368e0);
            padding: 6px 12px;
            border-radius: 20px;
            color: white;
            font-size: 0.85em;
        }
        
        .delay-info {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            color: #2d3436;
            font-size: 0.9em;
        }
        
        .delay-input-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .delay-input-group input {
            width: 150px;
        }
        
        .delay-input-group span {
            color: #666;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="nav-links">
        <a href="/" class="active">🏠 Dashboard</a>
        <a href="/history.html">📊 Request History</a>
        <a href="/files.html">📁 File Manager</a>
    </div>

    <h1>🚀 Universal Mock Server</h1>
    <p class="subtitle">Enhanced with SQLite/MongoDB support, binary files, custom headers, status codes, and response delays</p>
    
    <div class="container">
        <h2>🔧 Server Status & Statistics</h2>
        <div id="serverStatus" class="status-message">🔍 Checking server connection...</div>
        <div id="statsContainer"></div>
    </div>
    
    <div class="container">
        <h2>🎭 Current Scenario</h2>
        <div id="currentScenario" class="current-scenario">Loading...</div>
        <br>
        <div class="form-group">
            <label for="newScenario">Change Scenario:</label>
            <input type="text" id="newScenario" placeholder="Enter scenario name">
            <button onclick="setScenario()">Set Scenario</button>
        </div>
    </div>

    <div class="container">
        <h2>📋 All Scenarios</h2>
        <p>Click on a scenario to switch to it or view its mocks:</p>
        <div id="scenariosContainer" class="scenarios-grid">
            <div class="scenario-card">Loading scenarios...</div>
        </div>
        <br>
        <button onclick="loadAllScenarios()" class="refresh-btn">🔄 Refresh Scenarios</button>
    </div>

    <div class="container">
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('mock-tab')">🎭 Mock Responses</button>
                <button class="tab-button" onclick="switchTab('file-tab')">📁 File Upload</button>
            </div>
            
            <div id="mock-tab" class="tab-content active">
                <h2>🎭 Create New Mock Response</h2>
                
                <!-- Response Type Selector -->
                <div class="form-group">
                    <label>Response Type:</label>
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="responseType" value="json" checked onclick="toggleResponseType('json')" style="width: auto; margin-right: 10px;">
                            <span>📄 JSON Response</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="responseType" value="file" onclick="toggleResponseType('file')" style="width: auto; margin-right: 10px;">
                            <span>📁 File Response</span>
                        </label>
                    </div>
                </div>
                
                <form onsubmit="createMock(event)" id="mockForm">
                    <div class="form-group">
                        <label for="scenario">Scenario:</label>
                        <input type="text" id="scenario" required placeholder="e.g., FAP">
                        <button type="button" onclick="populateFromCurrentScenario()" class="dropdown-btn">Use Current Scenario</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="method">HTTP Method:</label>
                        <select id="method" required>
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                            <option value="PATCH">PATCH</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="path">Path:</label>
                        <input type="text" id="path" required placeholder="e.g., /test/fap">
                    </div>
                    
                    <!-- Enhanced Status Code Input Section -->
                    <div class="form-group">
                        <label for="statusCode">HTTP Status Code:</label>
                        <div class="status-code-group">
                            <input type="number" id="statusCode" min="100" max="599" value="200" placeholder="200" onchange="updateStatusDescription()">
                            <select id="statusCodePresets" onchange="applyStatusCodePreset()">
                                <option value="">-- Select Common Status Code --</option>
                                <optgroup label="2xx Success">
                                    <option value="200">200 OK</option>
                                    <option value="201">201 Created</option>
                                    <option value="202">202 Accepted</option>
                                    <option value="204">204 No Content</option>
                                    <option value="206">206 Partial Content</option>
                                </optgroup>
                                <optgroup label="3xx Redirection">
                                    <option value="301">301 Moved Permanently</option>
                                    <option value="302">302 Found</option>
                                    <option value="303">303 See Other</option>
                                    <option value="304">304 Not Modified</option>
                                    <option value="307">307 Temporary Redirect</option>
                                    <option value="308">308 Permanent Redirect</option>
                                </optgroup>
                                <optgroup label="4xx Client Error">
                                    <option value="400">400 Bad Request</option>
                                    <option value="401">401 Unauthorized</option>
                                    <option value="403">403 Forbidden</option>
                                    <option value="404">404 Not Found</option>
                                    <option value="405">405 Method Not Allowed</option>
                                    <option value="406">406 Not Acceptable</option>
                                    <option value="408">408 Request Timeout</option>
                                    <option value="409">409 Conflict</option>
                                    <option value="410">410 Gone</option>
                                    <option value="413">413 Payload Too Large</option>
                                    <option value="414">414 URI Too Long</option>
                                    <option value="415">415 Unsupported Media Type</option>
                                    <option value="422">422 Unprocessable Entity</option>
                                    <option value="429">429 Too Many Requests</option>
                                </optgroup>
                                <optgroup label="5xx Server Error">
                                    <option value="500">500 Internal Server Error</option>
                                    <option value="501">501 Not Implemented</option>
                                    <option value="502">502 Bad Gateway</option>
                                    <option value="503">503 Service Unavailable</option>
                                    <option value="504">504 Gateway Timeout</option>
                                    <option value="505">505 HTTP Version Not Supported</option>
                                </optgroup>
                            </select>
                        </div>
                        <div id="statusCodeDescription"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="rule">Rule (optional Jexl expression):</label>
                        <input type="text" id="rule" placeholder="e.g., inputPayload.userId == '123'">
                    </div>
                    
                    <!-- Response Delay Configuration -->
                    <div class="delay-section">
                        <h4>⏱️ Response Delay Configuration</h4>
                        <div class="delay-type-selector">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="radio" name="delayType" value="none" checked onclick="toggleDelayType('none')" style="width: auto; margin-right: 10px;">
                                <span>No Delay</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="radio" name="delayType" value="fixed" onclick="toggleDelayType('fixed')" style="width: auto; margin-right: 10px;">
                                <span>Fixed Delay</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="radio" name="delayType" value="random" onclick="toggleDelayType('random')" style="width: auto; margin-right: 10px;">
                                <span>Random Delay</span>
                            </label>
                        </div>
                        
                        <div id="fixedDelayConfig" class="delay-config">
                            <div class="form-group">
                                <label for="delayFixed">Fixed Delay (milliseconds):</label>
                                <input type="number" id="delayFixed" min="0" max="60000" placeholder="e.g., 1000" value="0">
                                <div class="delay-info">
                                    💡 Enter a fixed delay in milliseconds (1000ms = 1 second). The response will always be delayed by this amount.
                                </div>
                            </div>
                        </div>
                        
                        <div id="randomDelayConfig" class="delay-config">
                            <div class="form-group">
                                <label>Random Delay Range (milliseconds):</label>
                                <div class="delay-input-group">
                                    <span>Min:</span>
                                    <input type="number" id="delayMin" min="0" max="60000" placeholder="e.g., 500" value="0">
                                    <span>Max:</span>
                                    <input type="number" id="delayMax" min="0" max="60000" placeholder="e.g., 2000" value="0">
                                </div>
                                <div class="delay-info">
                                    💡 Enter a minimum and maximum delay. Each request will have a random delay between these values.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- JSON Response Section -->
                    <div id="jsonResponseSection" class="response-section">
                        <div class="form-group">
                            <label for="responseJson">Response JSON:</label>
                            <textarea id="responseJson" placeholder='{"message": "success", "data": {...}}'></textarea>
                        </div>
                    </div>
                    
                    <!-- File Response Section -->
                    <div id="fileResponseSection" class="response-section" style="display: none;">
                        <div class="form-group">
                            <label for="mockFileInput">Response File:</label>
                            <div class="file-upload-area" id="mockUploadArea">
                                <p>📎 Drag & drop file here or click to select</p>
                                <p><small>This file will be served as the response (PDF, Image, ZIP, etc.)</small></p>
                                <input type="file" id="mockFileInput" style="display: none;">
                            </div>
                            <div id="selectedMockFile"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="responseHeaders">Custom Response Headers (optional JSON):</label>
                        <textarea id="responseHeaders" class="headers-input" placeholder='{"X-Custom-Header": "value", "Cache-Control": "no-cache"}'></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="nextScenario">Next Scenario (optional):</label>
                        <input type="text" id="nextScenario" placeholder="e.g., FAP_RELEASED">
                        <small>If specified, the scenario will automatically switch to this when the mock is triggered</small>
                    </div>
                    
                    <button type="submit">🎭 Create Mock</button>
                </form>
            </div>
            
            <div id="file-tab" class="tab-content">
                <h2>📁 Upload Files</h2>
                <form onsubmit="uploadFiles(event)">
                    <div class="form-group">
                        <label for="fileScenario">Scenario:</label>
                        <input type="text" id="fileScenario" required placeholder="e.g., production">
                        <button type="button" onclick="document.getElementById('fileScenario').value = currentScenarioGlobal" class="dropdown-btn">Use Current Scenario</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="fileMethod">HTTP Method:</label>
                        <select id="fileMethod">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="fileInput">Select Files:</label>
                        <div class="file-upload-area" id="uploadArea">
                            <p>📎 Drag & drop files here or click to select</p>
                            <p><small>Supports: ZIP, TAR.GZ, CSV, JSON, images, and more</small></p>
                            <input type="file" id="fileInput" multiple style="display: none;">
                        </div>
                        <div id="selectedFiles"></div>
                    </div>
                    
                    <button type="submit" class="upload-btn">📤 Upload Files</button>
                </form>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>📋 Existing Mocks</h2>
        <div class="controls">
            <input type="text" id="viewScenario" placeholder="Enter scenario name">
            <button onclick="loadMockSummaries()">🔍 Load Mocks</button>
            <button onclick="loadAllMockSummaries()" class="dropdown-btn">📋 Load All Mocks</button>
            <input type="number" id="limitInput" value="50" min="10" max="500" placeholder="Limit">
        </div>
        <div id="mocksList"></div>
    </div>

    <div class="container">
        <h2>⚡ Quick Setup</h2>
        <button onclick="setupFAPExample()">🎭 Setup FAP → FAP_RELEASED Example</button>
        <button onclick="setupCompleteFlow()" class="dropdown-btn">🔄 Setup Complete FAP Flow</button>
        <button onclick="generateSampleCSV()" class="upload-btn">📊 Generate Sample CSV</button>
        <button onclick="setupFileMockExample()" class="upload-btn">📁 Setup File Mock Example</button>
        <button onclick="setupErrorExamples()" class="delete-btn">❌ Setup Error Response Examples</button>
        <button onclick="setupDelayExamples()" class="dropdown-btn">⏱️ Setup Delay Examples</button>
        <p><em>These will create example scenarios with auto-transitions, sample files, various status codes, and delays</em></p>
    </div>

    <script>
        let currentScenarioGlobal = 'default';
        let expandedMocks = new Set();
        let databaseType = 'sqlite';
        
        // Status code descriptions
        const statusCodeDescriptions = {
            // 2xx Success
            200: { icon: '✅', text: 'The request has succeeded. The information returned depends on the method used.' },
            201: { icon: '✅', text: 'The request has been fulfilled and resulted in a new resource being created.' },
            202: { icon: '✅', text: 'The request has been accepted for processing, but the processing has not been completed.' },
            204: { icon: '✅', text: 'The server successfully processed the request, but is not returning any content.' },
            206: { icon: '✅', text: 'The server is delivering only part of the resource due to a range header sent by the client.' },
            
            // 3xx Redirection
            301: { icon: '↪️', text: 'The resource has been moved permanently to a new location.' },
            302: { icon: '↪️', text: 'The resource resides temporarily under a different URI.' },
            303: { icon: '↪️', text: 'The response to the request can be found under a different URI.' },
            304: { icon: '↪️', text: 'The resource has not been modified since the last request.' },
            307: { icon: '↪️', text: 'The request should be repeated with another URI; however, future requests should still use the original URI.' },
            308: { icon: '↪️', text: 'The request and all future requests should be repeated using another URI.' },
            
            // 4xx Client Error
            400: { icon: '❌', text: 'The server cannot process the request due to a client error (e.g., malformed request syntax).' },
            401: { icon: '🔒', text: 'Authentication is required and has failed or has not been provided.' },
            403: { icon: '🚫', text: 'The server understood the request but refuses to authorize it.' },
            404: { icon: '🔍', text: 'The requested resource could not be found on the server.' },
            405: { icon: '🚫', text: 'The request method is not supported for the requested resource.' },
            406: { icon: '❌', text: 'The requested resource is only capable of generating content not acceptable according to the Accept headers.' },
            408: { icon: '⏱️', text: 'The server timed out waiting for the request.' },
            409: { icon: '⚠️', text: 'The request could not be completed due to a conflict with the current state of the resource.' },
            410: { icon: '💨', text: 'The requested resource is no longer available and will not be available again.' },
            413: { icon: '📦', text: 'The request is larger than the server is willing or able to process.' },
            414: { icon: '📏', text: 'The URI provided was too long for the server to process.' },
            415: { icon: '🎭', text: 'The request entity has a media type which the server does not support.' },
            422: { icon: '⚠️', text: 'The request was well-formed but was unable to be followed due to semantic errors.' },
            429: { icon: '🚦', text: 'The user has sent too many requests in a given amount of time.' },
            
            // 5xx Server Error
            500: { icon: '💥', text: 'The server encountered an unexpected condition that prevented it from fulfilling the request.' },
            501: { icon: '🚧', text: 'The server does not support the functionality required to fulfill the request.' },
            502: { icon: '🌉', text: 'The server received an invalid response from an upstream server.' },
            503: { icon: '🔧', text: 'The server is currently unable to handle the request due to temporary overloading or maintenance.' },
            504: { icon: '⏱️', text: 'The server did not receive a timely response from an upstream server.' },
            505: { icon: '📡', text: 'The server does not support the HTTP protocol version used in the request.' }
        };
        
        // Load current scenario on page load
        window.onload = function() {
            checkServerConnection();
            loadAllScenarios();
            setupFileUpload();
            setupMockFileUpload();
            updateStatusDescription(); // Initialize status description
        };
        
        // Function to toggle delay type
        function toggleDelayType(type) {
            document.getElementById('fixedDelayConfig').classList.remove('active');
            document.getElementById('randomDelayConfig').classList.remove('active');
            
            if (type === 'fixed') {
                document.getElementById('fixedDelayConfig').classList.add('active');
            } else if (type === 'random') {
                document.getElementById('randomDelayConfig').classList.add('active');
            }
        }
        
        // Function to apply status code from preset dropdown
        function applyStatusCodePreset() {
            const preset = document.getElementById('statusCodePresets').value;
            if (preset) {
                document.getElementById('statusCode').value = preset;
                updateStatusDescription();
            }
        }
        
        // Function to update status code description
        function updateStatusDescription() {
            const statusCode = document.getElementById('statusCode').value;
            const descriptionDiv = document.getElementById('statusCodeDescription');
            
            if (statusCode && statusCodeDescriptions[statusCode]) {
                const desc = statusCodeDescriptions[statusCode];
                descriptionDiv.innerHTML = `
                    <div class="status-info">
                        <span class="status-icon">${desc.icon}</span>
                        <span>${desc.text}</span>
                    </div>
                `;
                descriptionDiv.style.display = 'block';
            } else if (statusCode) {
                // Generic description for unknown codes
                const category = Math.floor(statusCode / 100);
                let genericDesc = '';
                let icon = '❓';
                
                switch(category) {
                    case 1:
                        genericDesc = 'Informational response';
                        icon = 'ℹ️';
                        break;
                    case 2:
                        genericDesc = 'Success response';
                        icon = '✅';
                        break;
                    case 3:
                        genericDesc = 'Redirection message';
                        icon = '↪️';
                        break;
                    case 4:
                        genericDesc = 'Client error response';
                        icon = '❌';
                        break;
                    case 5:
                        genericDesc = 'Server error response';
                        icon = '💥';
                        break;
                    default:
                        genericDesc = 'Custom status code';
                }
                
                descriptionDiv.innerHTML = `
                    <div class="status-info">
                        <span class="status-icon">${icon}</span>
                        <span>${genericDesc} (${statusCode})</span>
                    </div>
                `;
                descriptionDiv.style.display = 'block';
            } else {
                descriptionDiv.style.display = 'none';
            }
        }

        function switchTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        function toggleResponseType(type) {
            const jsonSection = document.getElementById('jsonResponseSection');
            const fileSection = document.getElementById('fileResponseSection');
            const responseJson = document.getElementById('responseJson');
            const mockFileInput = document.getElementById('mockFileInput');
            
            if (type === 'json') {
                jsonSection.style.display = 'block';
                fileSection.style.display = 'none';
                responseJson.setAttribute('required', 'required');
                mockFileInput.removeAttribute('required');
            } else {
                jsonSection.style.display = 'none';
                fileSection.style.display = 'block';
                responseJson.removeAttribute('required');
                mockFileInput.setAttribute('required', 'required');
            }
        }

        function setStatusCode(code) {
            document.getElementById('statusCode').value = code;
            updateStatusDescription();
        }

        // Setup file upload for mock creation
        function setupMockFileUpload() {
            const uploadArea = document.getElementById('mockUploadArea');
            const fileInput = document.getElementById('mockFileInput');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                fileInput.files = e.dataTransfer.files;
                displaySelectedMockFile();
            });
            
            fileInput.addEventListener('change', displaySelectedMockFile);
        }

        function displaySelectedMockFile() {
            const fileInput = document.getElementById('mockFileInput');
            const selectedFile = document.getElementById('selectedMockFile');
            
            if (fileInput.files.length === 0) {
                selectedFile.innerHTML = '';
                return;
            }
            
            const file = fileInput.files[0];
            const size = formatFileSize(file.size);
            selectedFile.innerHTML = `<h4>📁 Selected File:</h4><p><strong>${file.name}</strong> <span class="file-size">(${size})</span></p>`;
        }

        function setupFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                fileInput.files = e.dataTransfer.files;
                displaySelectedFiles();
            });
            
            fileInput.addEventListener('change', displaySelectedFiles);
        }

        function displaySelectedFiles() {
            const fileInput = document.getElementById('fileInput');
            const selectedFiles = document.getElementById('selectedFiles');
            
            if (fileInput.files.length === 0) {
                selectedFiles.innerHTML = '';
                return;
            }
            
            let html = '<h4>📁 Selected Files:</h4><ul>';
            for (let i = 0; i < fileInput.files.length; i++) {
                const file = fileInput.files[i];
                const size = formatFileSize(file.size);
                html += `<li><strong>${file.name}</strong> <span class="file-size">(${size})</span></li>`;
            }
            html += '</ul>';
            selectedFiles.innerHTML = html;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function uploadFiles(event) {
            event.preventDefault();
            
            const fileInput = document.getElementById('fileInput');
            const scenario = document.getElementById('fileScenario').value;
            const method = document.getElementById('fileMethod').value;
            
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('Please select files to upload');
                return;
            }
            
            if (!scenario) {
                alert('Please enter a scenario name');
                return;
            }
            
            const formData = new FormData();
            formData.append('scenario', scenario);
            formData.append('method', method);
            
            for (let i = 0; i < fileInput.files.length; i++) {
                formData.append('files', fileInput.files[i]);
            }
            
            try {
                const response = await fetch('/admin/files/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert(`✅ Files uploaded successfully!\n\nUploaded ${result.files.length} files to scenario "${scenario}"`);
                    
                    // Clear form
                    fileInput.value = '';
                    document.getElementById('selectedFiles').innerHTML = '';
                    document.getElementById('fileScenario').value = '';
                    
                    // Refresh stats
                    loadStats();
                } else {
                    const error = await response.json();
                    alert('❌ Upload failed: ' + error.error);
                }
            } catch (error) {
                alert('❌ Upload failed: ' + error.message);
                console.error('Upload error:', error);
            }
        }

        // Enhanced createMock function to handle both JSON and file responses with status codes and delays
        async function createMock(event) {
            event.preventDefault();
            
            const responseType = document.querySelector('input[name="responseType"]:checked').value;
            const scenario = document.getElementById('scenario').value;
            const method = document.getElementById('method').value;
            const path = document.getElementById('path').value;
            const statusCode = document.getElementById('statusCode').value || 200;
            const rule = document.getElementById('rule').value || null;
            const responseHeaders = document.getElementById('responseHeaders').value || null;
            const nextScenario = document.getElementById('nextScenario').value || null;
            
            // Get delay configuration
            const delayType = document.querySelector('input[name="delayType"]:checked').value;
            const delayFixed = document.getElementById('delayFixed').value || 0;
            const delayMin = document.getElementById('delayMin').value || 0;
            const delayMax = document.getElementById('delayMax').value || 0;
            
            if (responseType === 'json') {
                // Handle JSON response
                const responseJson = document.getElementById('responseJson').value;
                
                let response;
                try {
                    response = JSON.parse(responseJson);
                } catch (error) {
                    alert('❌ Invalid JSON in response field');
                    return;
                }
                
                try {
                    const apiResponse = await fetch('/admin/mock', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            scenario,
                            method,
                            path,
                            rule,
                            response,
                            responseHeaders,
                            statusCode,
                            nextScenario,
                            delayType,
                            delayFixed,
                            delayMin,
                            delayMax
                        })
                    });
                    
                    if (apiResponse.ok) {
                        const result = await apiResponse.json();
                        alert(`✅ Mock created successfully!\nStatus Code: ${statusCode}\n${result.customHeaders}\n${result.nextScenario}\n${result.delay}`);
                        resetMockForm();
                        loadAllScenarios();
                        loadStats();
                    } else {
                        const error = await apiResponse.json();
                        alert('❌ Error: ' + error.error);
                    }
                } catch (error) {
                    alert('❌ Error creating mock');
                    console.error('Error:', error);
                }
            } else {
                // Handle file response
                const fileInput = document.getElementById('mockFileInput');
                
                if (!fileInput.files || fileInput.files.length === 0) {
                    alert('Please select a file for the response');
                    return;
                }
                
                const formData = new FormData();
                formData.append('scenario', scenario);
                formData.append('method', method);
                formData.append('path', path);
                formData.append('statusCode', statusCode);
                if (rule) formData.append('rule', rule);
                if (responseHeaders) formData.append('responseHeaders', responseHeaders);
                if (nextScenario) formData.append('nextScenario', nextScenario);
                formData.append('delayType', delayType);
                formData.append('delayFixed', delayFixed);
                formData.append('delayMin', delayMin);
                formData.append('delayMax', delayMax);
                formData.append('files', fileInput.files[0]);
                
                try {
                    const apiResponse = await fetch('/admin/mock/file', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (apiResponse.ok) {
                        const result = await apiResponse.json();
                        alert(`✅ File-based mock created successfully!\n\nFile: ${result.filename}\nSize: ${formatFileSize(result.fileSize)}\nStatus Code: ${result.statusCode}\n${result.customHeaders}\n${result.nextScenario}\n${result.delay}`);
                        resetMockForm();
                        loadAllScenarios();
                        loadStats();
                    } else {
                        const error = await apiResponse.json();
                        alert('❌ Error: ' + error.error);
                    }
                } catch (error) {
                    alert('❌ Error creating file-based mock');
                    console.error('Error:', error);
                }
            }
        }

        function resetMockForm() {
            document.getElementById('mockForm').reset();
            document.getElementById('selectedMockFile').innerHTML = '';
            document.getElementById('statusCode').value = '200';
            document.getElementById('statusCodePresets').value = '';
            updateStatusDescription();
            document.querySelector('input[name="responseType"][value="json"]').checked = true;
            toggleResponseType('json');
            document.querySelector('input[name="delayType"][value="none"]').checked = true;
            toggleDelayType('none');
        }

        async function generateSampleCSV() {
            const sampleData = [
                { id: 1, name: 'Alice Johnson', email: 'alice@example.com', age: 28, department: 'Engineering' },
                { id: 2, name: 'Bob Smith', email: 'bob@example.com', age: 34, department: 'Marketing' },
                { id: 3, name: 'Carol Davis', email: 'carol@example.com', age: 29, department: 'Design' },
                { id: 4, name: 'David Wilson', email: 'david@example.com', age: 31, department: 'Engineering' },
                { id: 5, name: 'Eva Brown', email: 'eva@example.com', age: 26, department: 'Sales' }
            ];
            
            try {
                const response = await fetch('/admin/files/generate-csv', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        filename: `sample-data-${Date.now()}.csv`,
                        scenario: currentScenarioGlobal,
                        data: sampleData
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert(`✅ Sample CSV generated!\n\nFile: ${result.file.filename}\nSize: ${result.file.formattedSize}\nAccess: /files/${result.file.filename}`);
                    loadStats();
                } else {
                    const error = await response.json();
                    alert('❌ CSV generation failed: ' + error.error);
                }
            } catch (error) {
                alert('❌ CSV generation failed: ' + error.message);
                console.error('CSV generation error:', error);
            }
        }

        async function checkServerConnection() {
            try {
                const response = await fetch('/admin/scenario');
                if (response.ok) {
                    document.getElementById('serverStatus').innerHTML = '<span class="success">✅ Connected to Universal Mock Server</span>';
                    getCurrentScenario();
                    loadStats();
                } else {
                    throw new Error('Server responded with error');
                }
            } catch (error) {
                document.getElementById('serverStatus').innerHTML = '<span class="error">❌ Cannot connect to server. Make sure the server is running and database is available.</span>';
                document.getElementById('currentScenario').textContent = 'Server not available';
                console.error('Server connection error:', error);
            }
        }

        async function getCurrentScenario() {
            try {
                const response = await fetch('/admin/scenario');
                const data = await response.json();
                currentScenarioGlobal = data.scenario;
                document.getElementById('currentScenario').textContent = data.scenario;
                highlightActiveScenario(data.scenario);
            } catch (error) {
                document.getElementById('currentScenario').textContent = 'Error loading scenario';
                console.error('Error:', error);
            }
        }

        async function loadStats() {
            try {
                const response = await fetch('/admin/stats');
                const stats = await response.json();
                
                databaseType = stats.database_type;
                
                let statsHtml = '<div class="stats-grid">';
                statsHtml += `<div class="stat-card">
                    <div class="stat-number">${stats.scenario_count}</div>
                    <div class="stat-label">Scenarios</div>
                </div>`;
                statsHtml += `<div class="stat-card">
                    <div class="stat-number">${stats.mock_count}</div>
                    <div class="stat-label">Mock Responses</div>
                </div>`;
                statsHtml += `<div class="stat-card">
                    <div class="stat-number">${stats.request_count}</div>
                    <div class="stat-label">Total Requests</div>
                </div>`;
                if (stats.file_count !== undefined) {
                    statsHtml += `<div class="stat-card">
                        <div class="stat-number">${stats.file_count}</div>
                        <div class="stat-label">Uploaded Files</div>
                    </div>`;
                }
                statsHtml += '</div>';
                
                // Add database type indicator
                statsHtml += `<div style="margin-top: 15px; text-align: center;">
                    <span class="database-indicator">${stats.database_type} Database</span>
                </div>`;
                
                document.getElementById('statsContainer').innerHTML = statsHtml;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadAllScenarios() {
            try {
                const response = await fetch('/admin/scenarios');
                const data = await response.json();
                displayScenarios(data.scenarios);
            } catch (error) {
                document.getElementById('scenariosContainer').innerHTML = '<div class="error">Error loading scenarios</div>';
                console.error('Error:', error);
            }
        }

        function displayScenarios(scenarios) {
            const container = document.getElementById('scenariosContainer');
            
            if (scenarios.length === 0) {
                container.innerHTML = '<div class="scenario-card">No scenarios found</div>';
                return;
            }

            let html = '';
            scenarios.forEach(scenario => {
                const isActive = scenario === currentScenarioGlobal;
                html += `
                    <div class="scenario-card ${isActive ? 'active' : ''}" onclick="switchToScenario('${scenario}')">
                        <strong>${scenario}</strong>
                        ${isActive ? '<br><small>🔥 Current</small>' : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function highlightActiveScenario(activeScenario) {
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.classList.remove('active');
                if (card.textContent.includes(activeScenario)) {
                    card.classList.add('active');
                }
            });
        }

        async function switchToScenario(scenario) {
            try {
                const response = await fetch('/admin/scenario', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ scenario })
                });
                
                if (response.ok) {
                    getCurrentScenario();
                    loadAllScenarios();
                    document.getElementById('viewScenario').value = scenario;
                    loadMockSummaries();
                } else {
                    const error = await response.json();
                    alert('❌ Error: ' + error.error);
                }
            } catch (error) {
                alert('❌ Error switching scenario');
                console.error('Error:', error);
            }
        }

        function populateFromCurrentScenario() {
            document.getElementById('scenario').value = currentScenarioGlobal;
        }

        async function setScenario() {
            const scenario = document.getElementById('newScenario').value;
            if (!scenario) {
                alert('Please enter a scenario name');
                return;
            }

            try {
                const response = await fetch('/admin/scenario', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ scenario })
                });
                
                if (response.ok) {
                    getCurrentScenario();
                    loadAllScenarios();
                    document.getElementById('newScenario').value = '';
                    alert('✅ Scenario updated successfully');
                } else {
                    const error = await response.json();
                    alert('❌ Error: ' + error.error);
                }
            } catch (error) {
                alert('❌ Error setting scenario');
                console.error('Error:', error);
            }
        }

        // Mock loading functions
        async function loadMockSummaries() {
            const scenario = document.getElementById('viewScenario').value;
            if (!scenario) {
                alert('Please enter a scenario name');
                return;
            }

            try {
                document.getElementById('mocksList').innerHTML = '<div class="loading">🔍 Loading mock summaries...</div>';
                const response = await fetch(`/admin/mocks/${scenario}/summary`);
                if (response.ok) {
                    const data = await response.json();
                    displayMockSummaries(data.mocks, scenario);
                } else {
                    document.getElementById('mocksList').innerHTML = '<p class="error">❌ Error loading mocks</p>';
                }
            } catch (error) {
                document.getElementById('mocksList').innerHTML = '<p class="error">❌ Error loading mocks</p>';
                console.error('Error:', error);
            }
        }

        async function loadAllMockSummaries() {
            try {
                const limit = parseInt(document.getElementById('limitInput').value) || 50;
                
                document.getElementById('mocksList').innerHTML = '<div class="loading">🔍 Loading mock summaries...</div>';
                const response = await fetch(`/admin/mocks/summary?limit=${limit}`);
                if (response.ok) {
                    const data = await response.json();
                    displayMockSummaries(data.mocks, 'All Scenarios');
                } else {
                    document.getElementById('mocksList').innerHTML = '<p class="error">❌ Error loading mocks</p>';
                }
            } catch (error) {
                document.getElementById('mocksList').innerHTML = '<p class="error">❌ Error loading mocks</p>';
                console.error('Error:', error);
            }
        }

        function displayMockSummaries(mocks, scenarioName) {
            const container = document.getElementById('mocksList');
            expandedMocks.clear();
            
            if (mocks.length === 0) {
                container.innerHTML = `<p class="warning">⚠️ No mocks found for: ${scenarioName}</p>`;
                return;
            }

            let html = `<h3>🎭 Mocks for: ${scenarioName}</h3>`;
            
            // Group by scenario if showing all mocks
            if (scenarioName === 'All Scenarios') {
                const groupedMocks = {};
                mocks.forEach(mock => {
                    if (!groupedMocks[mock.scenario]) {
                        groupedMocks[mock.scenario] = [];
                    }
                    groupedMocks[mock.scenario].push(mock);
                });

                Object.keys(groupedMocks).forEach(scenario => {
                    html += `<h4>📋 Scenario: ${scenario}</h4>`;
                    groupedMocks[scenario].forEach(mock => {
                        html += createMockSummaryHtml(mock);
                    });
                });
            } else {
                mocks.forEach(mock => {
                    html += createMockSummaryHtml(mock);
                });
            }
            
            container.innerHTML = html;
        }

        function createMockSummaryHtml(mock) {
            const mockId = mock._id || mock.id;
            const methodClass = `method-${mock.method}`;
            const hasFile = !!mock.file_id;
            const statusCode = mock.status_code || 200;
            const statusClass = `status-${Math.floor(statusCode / 100)}xx`;
            const delayType = mock.delay_type || 'none';
            
            let delayBadge = '';
            if (delayType === 'fixed' && mock.delay_fixed > 0) {
                delayBadge = `<span class="delay-badge">⏱️ ${mock.delay_fixed}ms</span>`;
            } else if (delayType === 'random' && mock.delay_max > 0) {
                delayBadge = `<span class="delay-badge">⏱️ ${mock.delay_min}-${mock.delay_max}ms</span>`;
            }
            
            return `
                <div class="mock-item" id="mock-${mockId}" onclick="toggleMockDetails('${mockId}')">
                    <div class="mock-header">
                        <div class="mock-summary">
                            <span class="method-badge ${methodClass}">${mock.method}</span>
                            <span class="status-badge ${statusClass}">${statusCode}</span>
                            <strong>${mock.scenario}</strong>
                            <span>${mock.path}</span>
                            ${mock.query ? `<span>?${mock.query}</span>` : ''}
                            ${hasFile ? '<span class="file-badge">📁 FILE</span>' : '<span class="file-badge">📄 JSON</span>'}
                            ${delayBadge}
                            ${mock.rule ? `<span style="color: #666; font-size: 0.9em;">📋 Rule: ${mock.rule}</span>` : ''}
                        </div>
                        <div>
                            <span class="expand-icon" id="icon-${mockId}">▶</span>
                        </div>
                    </div>
                    ${mock.next_scenario ? `
                        <div class="scenario-flow">
                            <strong>🔄 Auto-transition:</strong> Will switch scenario to "${mock.next_scenario}" when triggered
                        </div>
                    ` : ''}
                    <div class="mock-details" id="details-${mockId}">
                        <div class="loading">Loading full mock details...</div>
                    </div>
                </div>
            `;
        }

        async function toggleMockDetails(mockId) {
            const detailsElement = document.getElementById(`details-${mockId}`);
            const iconElement = document.getElementById(`icon-${mockId}`);
            const mockElement = document.getElementById(`mock-${mockId}`);
            
            if (expandedMocks.has(mockId)) {
                // Collapse
                detailsElement.style.display = 'none';
                iconElement.textContent = '▶';
                iconElement.classList.remove('expanded');
                mockElement.classList.remove('expanded');
                expandedMocks.delete(mockId);
            } else {
                // Expand
                detailsElement.style.display = 'block';
                iconElement.textContent = '▼';
                iconElement.classList.add('expanded');
                mockElement.classList.add('expanded');
                expandedMocks.add(mockId);
                
                // Load detailed data if not already loaded
                if (detailsElement.innerHTML.includes('Loading full mock details')) {
                    try {
                        const response = await fetch(`/admin/mock/${mockId}`);
                        if (response.ok) {
                            const data = await response.json();
                            displayMockDetails(detailsElement, data.mock);
                        } else {
                            detailsElement.innerHTML = '<p class="error">❌ Error loading mock details</p>';
                        }
                    } catch (error) {
                        detailsElement.innerHTML = '<p class="error">❌ Error loading mock details</p>';
                        console.error('Error:', error);
                    }
                }
            }
        }

        // Enhanced mock details display to show file information, status code, and delay info
        function displayMockDetails(container, mock) {
            const mockId = mock._id || mock.id;
            const statusCode = mock.statusCode || mock.status_code || 200;
            const statusClass = `status-${Math.floor(statusCode / 100)}xx`;
            
            let detailsHtml = `
                <div><strong>📊 Status Code:</strong> <span class="status-badge ${statusClass}">${statusCode}</span></div>
            `;
            
            // Display delay information
            if (mock.delayType && mock.delayType !== 'none') {
                if (mock.delayType === 'fixed' && mock.delayFixed > 0) {
                    detailsHtml += `
                        <div><strong>⏱️ Delay:</strong> Fixed ${mock.delayFixed}ms</div>
                    `;
                } else if (mock.delayType === 'random' && mock.delayMax > 0) {
                    detailsHtml += `
                        <div><strong>⏱️ Delay:</strong> Random ${mock.delayMin}-${mock.delayMax}ms</div>
                    `;
                }
            }
            
            if (mock.responseHeaders) {
                detailsHtml += `
                    <div><strong>📋 Custom Headers:</strong></div>
                    <div class="json-preview">${JSON.stringify(mock.responseHeaders, null, 2)}</div>
                `;
            }
            
            if (mock.file_id && mock.file) {
                // File-based mock
                detailsHtml += `
                    <div><strong>📁 Response Type:</strong> File</div>
                    <div><strong>📄 File Name:</strong> ${mock.file.originalName}</div>
                    <div><strong>📦 File Size:</strong> ${mock.file.formattedSize}</div>
                    <div><strong>🏷️ MIME Type:</strong> ${mock.file.mimeType}</div>
                    <br>
                    <a href="/files/${mock.file.filename}" target="_blank" class="button">📥 Download File</a>
                `;
            } else {
                // JSON-based mock
                const response = typeof mock.response === 'string' ? JSON.parse(mock.response) : mock.response;
                detailsHtml += `
                    <div><strong>📄 Response Type:</strong> JSON</div>
                    <div><strong>📋 Response Body:</strong></div>
                    <div class="json-preview">${JSON.stringify(response, null, 2)}</div>
                `;
            }
            
            detailsHtml += `
                <br>
                <button class="delete-btn" onclick="deleteMock('${mockId}')">🗑️ Delete Mock</button>
            `;
            
            container.innerHTML = detailsHtml;
        }

        async function deleteMock(id) {
            if (!confirm('⚠️ Are you sure you want to delete this mock?')) {
                return;
            }

            try {
                const response = await fetch(`/admin/mock/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('✅ Mock deleted successfully');
                    // Refresh current view
                    const scenario = document.getElementById('viewScenario').value;
                    if (scenario) {
                        loadMockSummaries();
                    } else {
                        loadAllMockSummaries();
                    }
                    loadAllScenarios();
                    loadStats();
                } else {
                    const error = await response.json();
                    alert('❌ Error: ' + error.error);
                }
            } catch (error) {
                alert('❌ Error deleting mock');
                console.error('Error:', error);
            }
        }

        function setupFAPExample() {
            document.getElementById('scenario').value = 'FAP';
            document.getElementById('method').value = 'GET';
            document.getElementById('path').value = '/test/fap';
            document.getElementById('statusCode').value = '200';
            updateStatusDescription();
            document.getElementById('responseJson').value = JSON.stringify({
                message: 'fap set',
                timestamp: new Date().toISOString()
            }, null, 2);
            document.getElementById('nextScenario').value = 'FAP_RELEASED';
            
            // Set a fixed delay of 500ms
            document.querySelector('input[name="delayType"][value="fixed"]').checked = true;
            toggleDelayType('fixed');
            document.getElementById('delayFixed').value = '500';
        }

        async function setupCompleteFlow() {
            const mocks = [
                {
                    scenario: 'FAP',
                    method: 'GET',
                    path: '/test/fap',
                    statusCode: 200,
                    response: { message: 'fap set' },
                    nextScenario: 'FAP_RELEASED',
                    delayType: 'fixed',
                    delayFixed: 200
                },
                {
                    scenario: 'FAP_RELEASED',
                    method: 'GET',
                    path: '/test/fap',
                    statusCode: 200,
                    response: { message: 'fap released' },
                    delayType: 'random',
                    delayMin: 100,
                    delayMax: 500
                },
                {
                    scenario: 'FAP_RELEASED',
                    method: 'POST',
                    path: '/test/complete',
                    statusCode: 201,
                    response: { message: 'fap completed' },
                    nextScenario: 'FAP_COMPLETED',
                    delayType: 'fixed',
                    delayFixed: 1000
                },
                {
                    scenario: 'FAP_COMPLETED',
                    method: 'GET',
                    path: '/test/status',
                    statusCode: 200,
                    response: { message: 'fap fully completed', status: 'done' }
                }
            ];

            let successCount = 0;
            for (const mock of mocks) {
                try {
                    const response = await fetch('/admin/mock', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(mock)
                    });
                    if (response.ok) successCount++;
                } catch (error) {
                    console.error('Error creating mock:', error);
                }
            }

            alert(`✅ Complete FAP flow created!\n\nCreated ${successCount}/${mocks.length} mocks\nFAP → FAP_RELEASED → FAP_COMPLETED\n\nIncludes various delays for realistic response times`);
            loadAllScenarios();
            loadStats();
        }

        function setupFileMockExample() {
            // Switch to file response
            document.querySelector('input[name="responseType"][value="file"]').checked = true;
            toggleResponseType('file');
            
            // Fill in the form
            document.getElementById('scenario').value = 'documents';
            document.getElementById('method').value = 'GET';
            document.getElementById('path').value = '/api/contract.pdf';
            document.getElementById('statusCode').value = '200';
            updateStatusDescription();
            document.getElementById('responseHeaders').value = JSON.stringify({
                "Cache-Control": "public, max-age=3600",
                "X-Document-Version": "1.0"
            }, null, 2);
            document.getElementById('nextScenario').value = 'documents_accessed';
            
            // Set a random delay between 200-800ms
            document.querySelector('input[name="delayType"][value="random"]').checked = true;
            toggleDelayType('random');
            document.getElementById('delayMin').value = '200';
            document.getElementById('delayMax').value = '800';
            
            alert('📁 File mock example setup!\n\nNow select a PDF or any file to serve as the response.\nWhen GET /api/contract.pdf is called, the file will be served with status 200 and a random delay between 200-800ms.');
        }

        async function setupErrorExamples() {
            const errorMocks = [
                {
                    scenario: 'errors',
                    method: 'GET',
                    path: '/api/unauthorized',
                    statusCode: 401,
                    response: { error: 'Unauthorized', message: 'Missing or invalid token' },
                    responseHeaders: { "WWW-Authenticate": "Bearer realm=\"api\"" },
                    delayType: 'fixed',
                    delayFixed: 100
                },
                {
                    scenario: 'errors',
                    method: 'GET',
                    path: '/api/forbidden',
                    statusCode: 403,
                    response: { error: 'Forbidden', message: 'You do not have permission to access this resource' },
                    delayType: 'fixed',
                    delayFixed: 150
                },
                {
                    scenario: 'errors',
                    method: 'GET',
                    path: '/api/notfound',
                    statusCode: 404,
                    response: { error: 'Not Found', message: 'The requested resource does not exist' },
                    delayType: 'random',
                    delayMin: 50,
                    delayMax: 200
                },
                {
                    scenario: 'errors',
                    method: 'POST',
                    path: '/api/badrequest',
                    statusCode: 400,
                    response: { error: 'Bad Request', message: 'Invalid input data', errors: ['field1 is required', 'field2 must be a number'] },
                    delayType: 'fixed',
                    delayFixed: 200
                },
                {
                    scenario: 'errors',
                    method: 'GET',
                    path: '/api/servererror',
                    statusCode: 500,
                    response: { error: 'Internal Server Error', message: 'An unexpected error occurred' },
                    delayType: 'random',
                    delayMin: 500,
                    delayMax: 2000
                }
            ];

            let successCount = 0;
            for (const mock of errorMocks) {
                try {
                    const response = await fetch('/admin/mock', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(mock)
                    });
                    if (response.ok) successCount++;
                } catch (error) {
                    console.error('Error creating mock:', error);
                }
            }

            alert(`✅ Error response examples created!\n\nCreated ${successCount}/${errorMocks.length} error mocks in 'errors' scenario\n\nTry:\n- GET /api/unauthorized (401) - 100ms delay\n- GET /api/forbidden (403) - 150ms delay\n- GET /api/notfound (404) - Random 50-200ms delay\n- POST /api/badrequest (400) - 200ms delay\n- GET /api/servererror (500) - Random 500-2000ms delay`);
            loadAllScenarios();
            loadStats();
        }

        async function setupDelayExamples() {
            const delayMocks = [
                {
                    scenario: 'performance',
                    method: 'GET',
                    path: '/api/fast',
                    statusCode: 200,
                    response: { message: 'Lightning fast response', latency: 'none' },
                    delayType: 'none'
                },
                {
                    scenario: 'performance',
                    method: 'GET',
                    path: '/api/normal',
                    statusCode: 200,
                    response: { message: 'Normal response time', latency: '300ms' },
                    delayType: 'fixed',
                    delayFixed: 300
                },
                {
                    scenario: 'performance',
                    method: 'GET',
                    path: '/api/slow',
                    statusCode: 200,
                    response: { message: 'Slow response', latency: '2000ms' },
                    delayType: 'fixed',
                    delayFixed: 2000
                },
                {
                    scenario: 'performance',
                    method: 'GET',
                    path: '/api/variable',
                    statusCode: 200,
                    response: { message: 'Variable response time', latency: '100-1000ms' },
                    delayType: 'random',
                    delayMin: 100,
                    delayMax: 1000
                },
                {
                    scenario: 'performance',
                    method: 'GET',
                    path: '/api/unstable',
                    statusCode: 200,
                    response: { message: 'Unstable network simulation', latency: '50-5000ms' },
                    delayType: 'random',
                    delayMin: 50,
                    delayMax: 5000
                }
            ];

            let successCount = 0;
            for (const mock of delayMocks) {
                try {
                    const response = await fetch('/admin/mock', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(mock)
                    });
                    if (response.ok) successCount++;
                } catch (error) {
                    console.error('Error creating mock:', error);
                }
            }

            alert(`✅ Delay examples created!\n\nCreated ${successCount}/${delayMocks.length} performance mocks in 'performance' scenario\n\nTry:\n- GET /api/fast - No delay\n- GET /api/normal - Fixed 300ms delay\n- GET /api/slow - Fixed 2s delay\n- GET /api/variable - Random 100-1000ms delay\n- GET /api/unstable - Random 50-5000ms delay\n\nPerfect for testing loading states and timeouts!`);
            loadAllScenarios();
            loadStats();
        }

        // Debounce function to avoid too many requests while typing
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>